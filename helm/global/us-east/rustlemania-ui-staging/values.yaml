# US East Videocall Staging UI configuration

# Inherit from parent rustlemania-ui chart but with staging-specific overrides
rustlemania-ui:
  nameOverride: "videocall-staging-ui-us-east"
  fullnameOverride: "videocall-staging-ui-us-east"

  replicaCount: 1

  runtimeConfig:
    # Using values aligned with docker/Dockerfile.yew
    apiBaseUrl: "https://app.videocall.rs"
    wsUrl: "wss://websocket-singapore.webtransport.video,wss://websocket-us-east.webtransport.video"
    webTransportHost: "https://webtransport-singapore.webtransport.video,https://webtransport-us-east.webtransport.video"
    oauthEnabled: "false"
    e2eeEnabled: "false"
    webTransportEnabled: "true"
    usersAllowedToStream: ""
    serverElectionPeriodMs: 3000
    audioBitrateKbps: 16
    videoBitrateKbps: 160
    screenBitrateKbps: 160
    oauthProvider: "google"


  image:
    repository: securityunion/videocall-web-ui
    pullPolicy: Always
    tag: latest  # Use staging tag

  resources:
    limits:
      cpu: "50m"
      memory: "128Mi"
    requests:
      cpu: "20m"
      memory: "64Mi"

  # Service configuration (uses chart's service.yaml template)
  service:
    type: ClusterIP
    port: 80

  # Node selector for US East region
  nodeSelector:
    topology.kubernetes.io/region: "nyc1"

  # Certificate configuration using standalone Certificate resource
  certificate:
    enabled: true
    name: "videocall-staging-ui-us-east-tls"
    secretName: "videocall-staging-ui-us-east-tls"
    issuer: "letsencrypt-prod"
    issuerKind: "Issuer"
    dnsNames:
      - "staging-app.videocall.rs"

  ingress:
    enabled: true
    redirect: false  # Disable rustlemania.com redirect - we want website to handle it
    className: "nginx"
    annotations:
      # cert-manager.io/issuer: "letsencrypt-prod"  # REMOVED - using standalone Certificate instead
      nginx.ingress.kubernetes.io/ssl-redirect: "true"
    hosts:
      - host: staging-app.videocall.rs
        paths:
          - path: /
            pathType: Prefix
            service:
              name: "videocall-staging-ui-us-east"  # This matches fullnameOverride
              port:
                number: 80
    tls:
      - secretName: videocall-staging-ui-us-east-tls
        hosts:
          - staging-app.videocall.rs 