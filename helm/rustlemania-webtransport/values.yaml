# Default values for rustlemania.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.
nameOverride: ""
fullnameOverride: "rustlemania-webtransport"

replicaCount: 1
image:
  repository: securityunion/rustlemania-api
  pullPolicy: Always
  tag: latest
command: ['webtransport_server']
args: []
tlsSecret: webtransport-tls
certificateDomain: "webtransport.YOUR_DOMAIN_NAME"
certificate:
  issuerName: "letsencrypt-prod"
env:
  - name: RUST_LOG
    value: warn,quinn=warn,web-transport-quinn=warn,async_nats=warn
  - name: NATS_URL
    value: nats:4222
  - name: LISTEN_URL
    value: 0.0.0.0:443
  - name: HEALTH_LISTEN_URL
    value: 0.0.0.0:444
  - name: CERT_PATH
    value: /certs/tls.crt
  - name: KEY_PATH
    value: /certs/tls.key
  - name: TOKIO_WORKER_THREADS
    value: "1"  # Default for WebTransport services - adjust per region as needed
  - name: TOKIO_BLOCKING_THREADS
    value: "2"  # Small pool for blocking crypto operations
  - name: REGION
    value: "us-east"
  - name: HOSTNAME
    valueFrom:
      fieldRef:
        fieldPath: metadata.name
  - name: SERVER_ID
    valueFrom:
      fieldRef:
        fieldPath: metadata.name
  - name: SERVICE_TYPE
    value: webtransport
  - name: SERVER_STATS_INTERVAL_SECS
    value: "5"
resources:
  limits:
    cpu: "500m"
    memory: "768Mi"
  requests:
    cpu: "500m"
    memory: "384Mi"
podAnnotations: {}
podSecurityContext: {}
securityContext: {}
service:
  type: NodePort
  port: 443
  healthPort: 444
autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 100
  targetCPUUtilizationPercentage: 80
  targetMemoryUtilizationPercentage: 80
nodeSelector: {}
tolerations: []
affinity: {}
# Used to configure cloud provider specific LB service type
loadBalancerAnnotations:
  external-dns.alpha.kubernetes.io/hostname: "webtransport.YOUR_DOMAIN_NAME"